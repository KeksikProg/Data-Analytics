# Data Analytics (Weather Pipeline) üå¶Ô∏èüìä

**Weather Data Pipeline** ‚Äî —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ø–æ–ª–Ω—ã–π ETL-–ø—Ä–æ—Ü–µ—Å—Å:  
—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å API, –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ Spark –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.  
–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ **Apache Airflow**, —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ ‚Äî –≤ **Docker**.

---

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ API Open-Meteo)  
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ CSV –∏ PostgreSQL  
- –ì–æ–¥–æ–≤—ã–µ –∏ –º–µ—Å—è—á–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Spark  
- –ü–æ–¥—Å—á—ë—Ç –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç  
- –≠–∫—Å–ø–æ—Ä—Ç –∏—Ç–æ–≥–æ–≤ –≤ CSV  
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –≤ Jupyter Notebook  

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **`download_weather_dag.py`**  
  DAG Airflow –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ª–µ—Ç.  
  - API: [Open-Meteo Archive](https://open-meteo.com/)  
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç CSV –≤ `data/raw/`

- **`load_database_dag.py`**  
  DAG Airflow –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CSV –≤ PostgreSQL (`weather_raw`).  
  - –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏  
  - –î–æ–±–∞–≤–ª—è–µ—Ç –≥–æ–¥ –∫ —Å—Ç—Ä–æ–∫–∞–º  
  - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≥–æ–¥—ã  

- **`agg_weaher_dag.py`**  
  DAG Airflow –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞–∂–¥–æ–º—É –≥–æ–¥—É —Å –ø–æ–º–æ—â—å—é Spark (`spark_job.py`).  
  - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ –≥–æ–¥–∞–º  
  - –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–∞—Å–∫ —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (`overall_stats_job.py`)  

- **`main_weather_pipeline.py`**  
  –ì–ª–∞–≤–Ω—ã–π DAG, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–∏ —ç—Ç–∞–ø–∞: download_weather_dag ‚Üí load_database_dag ‚Üí agg_weather_dag

- **`spark_job.py`**  
Spark-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≥–æ–¥—É:  
- min/max/avg —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –æ—Å–∞–¥–∫–æ–≤  
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `weather_meta_<–≥–æ–¥>`

- **`overall_stats_job.py`**  
Spark-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –ª–µ—Ç –∏ –ø–æ–¥—Å—á—ë—Ç–∞ —Å–≤–æ–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏  
(—Å—Ä–µ–¥–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º). –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `weather_overall`.

- **`export_weather_overall.py`**  
Spark-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ `weather_overall` –≤ CSV (–æ–¥–∏–Ω —Ñ–∞–π–ª —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏).

- **`weather_analysis.ipynb`**  
Jupyter Notebook –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:  
- –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –≥–æ–¥–∞–º  
- –¥–∏–Ω–∞–º–∏–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –æ—Å–∞–¥–∫–æ–≤  
- –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ ‚Äî –ø—Ä–æ–≥–Ω–æ–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞  

- **`Dockerfile`**  
Docker-–æ–±—Ä–∞–∑ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (Airflow, Spark, PostgreSQL –¥—Ä–∞–π–≤–µ—Ä—ã).

---

## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- [Apache Airflow](https://airflow.apache.org/) ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞  
- [Apache Spark](https://spark.apache.org/) ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö  
- [PostgreSQL](https://www.postgresql.org/) ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö  
- [Docker + docker-compose](https://docs.docker.com/) ‚Äî —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ  
- [Open-Meteo API](https://open-meteo.com/) ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
- [Jupyter Notebook](https://jupyter.org/) ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è  

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
git clone https://github.com/your-username/weather-data-pipeline.git
cd weather-data-pipeline
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–µ–º `.env` —Ñ–∞–π–ª:
```env
OPENMETEO_LAT=55.75
OPENMETEO_LON=37.61
DB_USER=airflow
DB_PASSWORD=airflow
DB_HOST=postgres
DB_PORT=5432
DB_NAME=weather
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
```bash
docker-compose up -d
```

### 4. –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ Airflow UI –∏ –∑–∞–ø—É—Å–∫–∞–µ–º DAG:
- `download_weather_dag` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `load_database_dag` - –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –±–∞–∑—É
- `agg_weather_dag` - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### 5. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
–û—Ç–∫—Ä–æ–µ–º `weather_analysis.ipynb` –∏ –ø–æ—Å—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫–∏\–ø—Ä–æ–≥–Ω–æ–∑—ã

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –¢–∞–±–ª–∏—Ü–∞ weather_raw ‚Äî —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
- –¢–∞–±–ª–∏—Ü—ã weather_meta_<–≥–æ–¥> ‚Äî –≥–æ–¥–æ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
- –¢–∞–±–ª–∏—Ü–∞ weather_overall ‚Äî —Å–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV: output/weather_overall
- –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ Jupyter
